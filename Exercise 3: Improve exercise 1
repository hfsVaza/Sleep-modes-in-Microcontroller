#include <avr/io.h>
#include <avr/interrupt.h>
#include <avr/sleep.h>

volatile uint8_t led_on = 0;

ISR(TIMER1_COMPA_vect)
{
    // Wake up CPU
    led_on = 1;

    //Timer0 is 0.1s
    TCNT0 = 0;
    OCR0A = 156;                    
    TCCR0B |= (1 << CS02) | (1 << CS00); // Prescaler 1024
    TIMSK0 |= (1 << OCIE0A);          
}

ISR(TIMER0_COMPA_vect)
{
    PORTB &= ~(1 << PB5);             
    TCCR0B = 0;                        
    TIMSK0 &= ~(1 << OCIE0A);         
}

int main(void)
{
    DDRB |= (1 << PB5);

    TCCR1B |= (1 << WGM12);
    OCR1A = 15624;
    TCCR1B |= (1 << CS12) | (1 << CS10);
    TIMSK1 |= (1 << OCIE1A);

    sei();

    set_sleep_mode(SLEEP_MODE_IDLE);
    sleep_enable();

    while (1)
    {
        sleep_cpu();          // sleep until Timer1 wakes

        if (led_on) {
            PORTB |= (1 << PB5);
            led_on = 0;      
        }
    }
}
