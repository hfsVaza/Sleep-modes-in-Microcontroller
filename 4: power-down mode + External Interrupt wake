#include <avr/io.h>
#include <avr/interrupt.h>
#include <avr/sleep.h>

volatile uint8_t wake_flag = 0;

ISR(INT0_vect)
{
    wake_flag = 1;
}

uint16_t read_ADC(void)
{
    ADMUX = (1 << REFS0);     
    ADCSRA |= (1 << ADEN);    // enable ADC
    ADCSRA |= (1 << ADSC);  
    while (ADCSRA & (1 << ADSC));
    return ADC;
}

int main(void)
{
    // Button on INT0 (PD2)
    EICRA |= (1 << ISC01);    //falling edge
    EIMSK |= (1 << INT0);

    sei();

    set_sleep_mode(SLEEP_MODE_PWR_DOWN);
    sleep_enable();

    while (1)
    {
        sleep_cpu();           

        if (wake_flag)
        {
            uint16_t value = read_ADC(); // read potentiometer
            wake_flag = 0;

        }
    }
}
